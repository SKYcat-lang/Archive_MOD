add_namespace = RED_event
add_namespace = RED_unite_kibotos
add_namespace = RED_instability_system


country_event = { # 군정청: 민주주의 지지도가 30% 이상일때 격발 히든 이벤트
	id = RED_instability_system.1
	title = RED_instability_system.1.t
	desc = RED_instability_system.1.d

	hidden = yes

	mean_time_to_happen = {
		days = 2
	}

	trigger = {
		RED_this_country_is_under_military_government = yes
		RED_instability_system_operational = yes
		democratic > 0.30
	}

	immediate = {
		RED_instability_system_up_effect = yes
		add_popularity = {
			ideology = democratic
			popularity = -0.15
		}
		if = { limit = { has_idea = RED_military_government_idea_3 is_subject = yes }
			OVERLORD = { country_event = { id = RED_instability_system.2 days = 2 } }
		}
	}
	option = {
		name = RED_instability_system.1.a
	}
}
country_event = { # 붉은겨울: 하나라도 불안정함 도달시 알림
	id = RED_instability_system.2
	title = RED_instability_system.2.t
	desc = RED_instability_system.2.d

	fire_only_once = yes
	is_triggered_only = yes
	
	option = {
		name = RED_instability_system.2.a
		add_political_power = 10
		add_command_power = 10
		custom_effect_tooltip = RED_instability_system_2_tt
	}
}
country_event = { # 군정청: 무작위로 발생하는 이벤트
	id = RED_instability_system.3
	title = RED_instability_system.3.t
	desc = RED_instability_system.3.d

	is_triggered_only = yes

	immediate = {
		hidden_effect = {
			country_event = { id = RED_instability_system.3 days = 80 random_days = 70 }
		}
	}
	
	option = {
		name = RED_instability_system.3.a
		ai_chance = {
			factor = 7
		}
		add_stability = -0.05
		random_list = {
			1 = {
				add_popularity = {
					ideology = democratic
					popularity = 0.02
				}
			}
			1 = {
				add_popularity = {
					ideology = democratic
					popularity = 0.05
				}
			}
			2 = {
				add_popularity = {
					ideology = democratic
					popularity = 0.08
				}
			}
			3 = {
				add_popularity = {
					ideology = democratic
					popularity = 0.10
				}
			}
			2 = {
				add_popularity = {
					ideology = democratic
					popularity = 0.12
				}
			}
			1 = {
				add_popularity = {
					ideology = democratic
					popularity = 0.15
				}
			}
			1 = {
				add_popularity = {
					ideology = democratic
					popularity = 0.18
				}
			}
		}
	}
	option = {
		name = RED_instability_system.3.b
		ai_chance = {
			factor = 10
		}
		trigger = {
			has_political_power > 50
			NOT = {
				has_idea = RED_military_government_idea_3
				has_idea = RED_military_government_idea_4
			}
		}
		add_political_power = -50
		add_popularity = {
			ideology = democratic
			popularity = -0.20
		}
	}
}
country_event = { # 군정청: 00의 봄
	id = RED_instability_system.4
	title = RED_instability_system.4.t
	desc = RED_instability_system.4.d
	picture = GFX_report_event_BOL_bolivian_socialist_revolution

	is_triggered_only = yes
	immediate = {
		set_global_flag = RED_instability_system_independence_flag
		RED_instability_system_remove_effect = yes
	}
	
	option = {
		name = RED_instability_system.4.a
		if = { limit = { is_subject = yes }
			overlord = {
				save_global_event_target_as = RED_instability_system_independence_overlord_target
				set_truce = {
					target = ROOT
					days = 1080
				}
			}
			set_global_flag = RED_instability_system_rebellion_overlordyes_flag
		}
		if = { limit = { tag = RE4 }
			FIN = { save_event_target_as = RED_instability_system_independence_country_target }
		}
		if = { limit = { tag = RE3 }
			SWE = { save_event_target_as = RED_instability_system_independence_country_target }
		}
		if = { limit = { tag = RE2 }
			NOR = { save_event_target_as = RED_instability_system_independence_country_target }
		}
		if = { limit = { tag = RE1 }
			DEN = { save_event_target_as = RED_instability_system_independence_country_target }
		}
		event_target:RED_instability_system_independence_country_target = {
			annex_country = {
				target = ROOT
				transfer_troops = yes
			}
			set_technology = {
				kivotos_infantry_weapons = 1
			}
			set_variable = { ROOT.halo_infantry_cap = 6 } # 사단 제한, 헤일로 보병의 사단 제한과 같아야 함
			set_country_flag = kivotos_research_on
			division_template = {
				name = "Scandinavian Independence Army"
				priority = 1
				division_names_group = SWE_INF_01
				is_locked = no

				regiments = {
					infantry = { x = 0 y = 0 }
					infantry = { x = 0 y = 1 }
					infantry = { x = 0 y = 2 }
					infantry = { x = 1 y = 0 }
					infantry = { x = 1 y = 1 }
					infantry = { x = 1 y = 2 }
				}
			}
			every_controlled_state = {
				create_unit = {
					division = "name = \"Scandinavian Independence Army\" division_template = \"Scandinavian Independence Army\" start_experience_factor = 0.8 start_equipment_factor = 0.35"
					owner = PREV
				}
				create_unit = {
					division = "name = \"Scandinavian Independence Army\" division_template = \"Scandinavian Independence Army\" start_experience_factor = 0.5 start_equipment_factor = 0.10"
					owner = PREV
				}
			}
			clr_country_flag = RED_instability_system_independence_country_flag
			if = { limit = { country_exists = RE1 }
				set_truce = {
					target = RE1
					days = 280
				}
			}
			if = { limit = { country_exists = RE2 }
				set_truce = {
					target = RE2
					days = 280
				}
			}
			if = { limit = { country_exists = RE3 }
				set_truce = {
					target = RE3
					days = 280
				}
			}
			if = { limit = { country_exists = RE4 }
				set_truce = {
					target = RE4
					days = 280
				}
			}
			set_country_flag = RED_instability_system_military_government_rebellion
			country_event = RED_instability_system.5
			if = { limit = { ROOT = { is_ai = no } }
				change_tag_from = ROOT
			}
		}
	}
	option = {
		name = RED_instability_system.4.b
		if = { limit = { tag = RE4 }
			random_owned_state = {
				transfer_state_to = FIN
			}
			random_owned_controlled_state = {
				limit = {
					any_neighbor_state = {
						is_owned_by = FIN
					}
				}
				transfer_state_to = FIN
			}
			random_owned_controlled_state = {
				limit = {
					any_neighbor_state = {
						is_owned_by = FIN
					}
				}
				transfer_state_to = FIN
			}
			FIN = { save_event_target_as = RED_instability_system_independence_country_target }
		}
		if = { limit = { tag = RE3 }
			random_owned_state = {
				transfer_state_to = SWE
			}
			random_owned_controlled_state = {
				limit = {
					any_neighbor_state = {
						is_owned_by = SWE
					}
				}
				transfer_state_to = SWE
			}
			random_owned_controlled_state = {
				limit = {
					any_neighbor_state = {
						is_owned_by = SWE
					}
				}
				transfer_state_to = SWE
			}
			SWE = { save_event_target_as = RED_instability_system_independence_country_target }
		}
		if = { limit = { tag = RE2 }
			random_owned_state = {
				transfer_state_to = NOR
			}
			random_owned_controlled_state = {
				limit = {
					any_neighbor_state = {
						is_owned_by = NOR
					}
				}
				transfer_state_to = NOR
			}
			random_owned_controlled_state = {
				limit = {
					any_neighbor_state = {
						is_owned_by = NOR
					}
				}
				transfer_state_to = NOR
			}
			NOR = { save_event_target_as = RED_instability_system_independence_country_target }
		}
		if = { limit = { tag = RE1 }
			random_owned_state = {
				transfer_state_to = DEN
			}
			random_owned_controlled_state = {
				limit = {
					any_neighbor_state = {
						is_owned_by = DEN
					}
				}
				transfer_state_to = DEN
			}
			random_owned_controlled_state = {
				limit = {
					any_neighbor_state = {
						is_owned_by = DEN
					}
				}
				transfer_state_to = DEN
			}
			DEN = { save_event_target_as = RED_instability_system_independence_country_target }
		}

		event_target:RED_instability_system_independence_country_target = {
			division_template = {
				name = "Scandinavian Independence Army"
				priority = 1
				division_names_group = SWE_INF_01
				is_locked = no

				regiments = {
					infantry = { x = 0 y = 0 }
					infantry = { x = 0 y = 1 }
					infantry = { x = 0 y = 2 }
					infantry = { x = 1 y = 0 }
					infantry = { x = 1 y = 1 }
					infantry = { x = 1 y = 2 }
				}
			}
			every_controlled_state = {
				create_unit = {
					division = "name = \"Scandinavian Independence Army\" division_template = \"Scandinavian Independence Army\" start_experience_factor = 0.8 start_equipment_factor = 0.35"
					owner = PREV
				}
				create_unit = {
					division = "name = \"Scandinavian Independence Army\" division_template = \"Scandinavian Independence Army\" start_experience_factor = 0.5 start_equipment_factor = 0.10"
					owner = PREV
				}
			}
			ROOT = {
				declare_war_on = {
					target = PREV
					type = annex_everything
				}
				add_civil_war_target = PREV
			}
			country_event = RED_instability_system.5
		}
	}
}
country_event = { # 군정청: 00의 봄 - 히든 이벤트
	id = RED_instability_system.5
	title = RED_instability_system.5.t
	desc = RED_instability_system.5.d

	hidden = yes
	is_triggered_only = yes

	immediate = {
		news_event = { id = BA_news.72 }
		if = { limit = { has_country_flag = RED_instability_system_military_government_rebellion }
			if = {
				limit = {
					has_global_flag = RED_instability_system_rebellion_overlordyes_flag
				}
				clr_global_flag = RED_instability_system_rebellion_overlordyes_flag

				event_target:RED_instability_system_independence_overlord_target = {
					country_event = { id = RED_instability_system.6 days = 4 }
					set_country_flag = RED_instability_system_hard_process
				}
			}
		}
	}
	option = {
		name = RED_instability_system.1.a
	}
}
country_event = { # 붉은겨울: 00의 봄 - 평화 제의
	id = RED_instability_system.6
	title = RED_instability_system.6.t
	desc = RED_instability_system.6.d
	picture = GFX_report_event_BOL_bolivian_socialist_revolution

	is_triggered_only = yes
	
	option = {
		name = RED_instability_system.6.a
		if = { limit = { tag = RED }
			if = { limit = { FROM = { tag = DEN } }
				activate_mission = RED_military_government_attack_DEN
			}
			if = { limit = { FROM = { tag = NOR } }
				activate_mission = RED_military_government_attack_NOR
			}
			if = { limit = { FROM = { tag = SWE } }
				activate_mission = RED_military_government_attack_SWE
			}
			if = { limit = { FROM = { tag = FIN } }
				activate_mission = RED_military_government_attack_FIN
			}
		}
		else = {
			create_wargoal = {
				target = FROM
				type = puppet_wargoal_focus
			}
		}
		FROM = {
			country_event = { id = RED_instability_system.61 days = 1 }
		}
	}
	option = {
		name = RED_instability_system.6.b
		add_stability = -0.05
		FROM = {
			country_event = { id = RED_instability_system.62 days = 1 }
		}
	}
}
country_event = { # 붉은겨울: 00의 봄 - 평화 제의 - a 침묵으로 일관하는 연방학원
	id = RED_instability_system.61
	title = RED_instability_system.61.t
	desc = RED_instability_system.61.d
	picture = GFX_report_event_BOL_bolivian_socialist_revolution

	is_triggered_only = yes
	
	option = {
		name = RED_instability_system.61.a
		add_war_support = 0.05
	}
}
country_event = { # 붉은겨울: 00의 봄 - 평화 제의 - b 통제받기 시작한 경제
	id = RED_instability_system.62
	title = RED_instability_system.62.t
	desc = RED_instability_system.62.d
	picture = GFX_report_event_BOL_bolivian_socialist_revolution

	is_triggered_only = yes
	
	option = {
		name = RED_instability_system.62.a
		add_timed_idea = {
			idea = RED_economic_loyalty_idea
			days = 1080
		}
		add_war_support = -0.05
	}
}
country_event = { # 붉은겨울: 00의 봄 - 내전에 빠진 군정청
	id = RED_instability_system.7
	title = RED_instability_system.7.t
	desc = RED_instability_system.7.d
	picture = GFX_report_event_BOL_bolivian_socialist_revolution

	fire_only_once = yes
	is_triggered_only = yes
	
	option = {
		name = RED_instability_system.7.a
		if = { limit = { FROM = { tag = DEN } }
			activate_mission = RED_military_government_attack_DEN
		}
		if = { limit = { FROM = { tag = NOR } }
			activate_mission = RED_military_government_attack_NOR
		}
		if = { limit = { FROM = { tag = SWE } }
			activate_mission = RED_military_government_attack_SWE
		}
		if = { limit = { FROM = { tag = FIN } }
			activate_mission = RED_military_government_attack_FIN
		}
	}
	option = {
		name = RED_instability_system.7.b
	}
}
country_event = { # 고틀란드냐 전쟁이냐
	id = RED_event.1
	title = RED_event.1.t
	desc = RED_event.1.d
	picture = GFX_report_event_german_troops

	is_triggered_only = yes

	trigger = {
		NOT = { has_war_with = FROM }
	}

	option = {
		name = RED_event.1.a
		ai_chance = {
			base = 40
			modifier = {
				factor = 10
				OR = {
					Kivotos_school_tag = yes
					is_in_faction_with = FROM
				}
			}
		}
		FROM = { country_event = { id = RED_event.2 days = 1 } }
		effect_tooltip = {
			FROM = {
				transfer_state = 124
				add_state_core = 124
				transfer_state = 910
				add_state_core = 910
			}
			ROOT = {
				remove_state_claim = 124
				remove_state_claim = 910
			}
		}
	}

	option = {
		name = RED_event.1.b
		ai_chance = {
			base = 40
			modifier = {
				add = -40
				is_major = no
			}
			modifier = {
				add = 80
				any_other_country = {
					is_major = yes
					is_in_faction_with = ROOT
				}
			}
			modifier = {
				add = 80
				AND = {
					Kivotos_school_tag = no
					is_major = yes
				}
			}
			modifier = {
				add = 80
				tag = GEN
			}
		}
		FROM = {
			country_event = { id = RED_event.3 days = 1 }
			if = {
				limit = {
					is_in_faction_with = ROOT
					is_faction_leader = yes
				}
				remove_from_faction = ROOT
			}
			if = {
				limit = {
					is_in_faction_with = ROOT
					is_faction_leader = no
				}
				random_other_country = {
					limit = {
						is_in_faction_with = FROM
						is_faction_leader = yes
					}
					remove_from_faction = FROM
				}
			}
		}
		effect_tooltip = {
			FROM = {
				create_wargoal = {
					target = ROOT
					type = take_state
					generator = { 124 }
				}
			}
		}
	}
}
country_event = { # 독일 수락
	id = RED_event.2
	title = RED_event.2.t
	desc = RED_event.2.d
	picture = GFX_report_event_german_polish_border

	is_triggered_only = yes

	option = {
		name = RED_event.2.a
		ROOT = {
			transfer_state = 124
			add_state_core = 124
			transfer_state = 910
			add_state_core = 910
		}
		FROM = {
			remove_state_claim = 124
			remove_state_claim = 910
		}
	}
}
country_event = { # 독일 거부
	id = RED_event.3
	title = RED_event.3.t
	desc = RED_event.3.d
	picture = GFX_report_event_polish_tanks_02

	is_triggered_only = yes

	option = {
		name = RED_event.3.a
		if = {
			limit = {
				FROM = {
					is_subject = yes
					OVERLORD = {
						has_non_aggression_pact_with = ROOT
					}
				}
			}
			FROM = {
				OVERLORD = {
					diplomatic_relation = {
						country = ROOT
						relation = non_aggression_pact
						active = no
					}
				}
			}
		}
		if = {
			limit = {
				FROM = {
					has_non_aggression_pact_with = ROOT
				}
			}
			FROM = {
				diplomatic_relation = {
					country = ROOT
					relation = non_aggression_pact
					active = no
				}
			}
			every_other_country = {
				limit = {
					has_non_aggression_pact_with = ROOT
				}
				add_opinion_modifier = {
					target = ROOT
   					modifier = protest_action_strong
				}
			}
		}
		create_wargoal = {
			target = FROM
			type = take_state
			generator = { 124 }
		}
		add_state_core = 124
	}
}

country_event = { #현지인 문제
	id = RED_event.4
	title = RED_event.4.t
	desc = RED_event.4.d
	picture = GFX_report_event_worker_protests

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = RED_event.4.a
		complete_national_focus = RED_enticing_locals
	}
	option = {
		name = RED_event.4.b
		complete_national_focus = RED_depress_locals
	}
}

country_event = { #선거(아님)
	id = RED_event.5
	title = RED_event.5.t
	desc = RED_event.5.d
	picture = GFX_report_event_election_vote

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = RED_event.5.a
		country_event = { id = RED_event.6 days = 2 }
	}
	option = {
		name = RED_event.5.a
		country_event = { id = RED_event.6 days = 2 }
	}
}
country_event = { #이딴게 투표?
	id = RED_event.6
	title = RED_event.6.t
	desc = RED_event.6.d
	picture = GFX_report_event_king_speech

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = RED_event.6.a
		add_stability = -0.05
	}
}

country_event = { #너, 내 동료가 돼라
	id = RED_event.7
	title = RED_event.7.t
	desc = RED_event.7.d
	picture = GFX_report_event_military_planning

	is_triggered_only = yes

	option = { #좋다
		name = RED_event.7.a
		add_war_support = 0.10
		FROM = {
			add_to_faction = ROOT
			country_event = RED_event.8
		}
		ai_chance = {
			base = 40
			modifier = {
				add = 40
				has_opinion = {
					target = FROM
					value > 0
				}
			}
			modifier = {
				add = -40
				has_opinion = {
					target = SOV
					value > 30
				}
			}
		}
	}
	option = { #싫다
		name = RED_event.7.b
		add_opinion_modifier = {
			target = FROM
			modifier = refused_anti_comintern_pact_opinion
		}
		FROM = {
			country_event = RED_event.9
		}
		ai_chance = {
			base = 40
			modifier = {
				add = 40
				has_opinion = {
					target = SOV
					value > 30
				}
			}
			modifier = {
				add = -40
				has_opinion = {
					target = FROM
					value > 0
				}
			}
		}
	}
}
country_event = { #동맹 수락
	id = RED_event.8
	title = RED_event.8.t
	desc = RED_event.8.d
	picture = GFX_report_event_generic_sign_treaty1

	is_triggered_only = yes

	option = {
		name = RED_event.8.a
	}
}
country_event = { #동맹 거절
	id = RED_event.9
	title = RED_event.9.t
	desc = RED_event.9.d
	picture = GFX_report_event_czech_soldiers_01

	is_triggered_only = yes

	option = {
		name = RED_event.9.a
	}
}

country_event = { #적색경보 해제
	id = RED_event.10
	title = RED_event.10.t
	desc = RED_event.10.d
	picture = GFX_report_event_chinese_soldiers_fighting

	is_triggered_only = yes
	fire_only_once = yes

	option = {
		name = RED_event.10.a
		if = {
			limit = {
				has_idea = RED_doomed_army_idea
			}
			remove_ideas = RED_doomed_army_idea
		}
		else = {
			add_war_support = 0.15
		}
	}
}

country_event = { #붉은겨울 수염공항
	id = RED_event.11
	title = RED_event.11.t
	desc = RED_event.11.d
	picture = GFX_report_event_generic_read_write

	is_triggered_only = yes

	option = { # 1번 선택 
		name = RED_event.11.a
		add_political_power = -200
		add_command_power = -50
		country_event = { id = RED_event.12 days = 120 }
	}
	option = { # 2번 선택
		name = RED_event.11.b
		add_political_power = -75
		country_event = { id = RED_event.13 days = 60 }
	}
}
country_event = { # 1번 선택지
	id = RED_event.12
	title = RED_event.12.t
	desc = RED_event.12.d
	picture = GFX_report_event_generic_bombers

	is_triggered_only = yes

	option = {
		name = RED_event.12.a
		141 = {
			add_building_construction = {
				type = air_base
				level = 3
				instant_build = yes
			}
			add_state_modifier = {
				modifier = { 
					local_supplies = 0.25
				}
			}
		}
	}
}
country_event = { # 2번 선택지
	id = RED_event.13
	title = RED_event.13.t
	desc = RED_event.13.d
	picture = GFX_report_event_tur_military_affair

	is_triggered_only = yes

	option = {
		name = RED_event.13.a
		141 = {
			add_building_construction = {
				type = air_base
				level = 1
				instant_build = yes
			}
		}
	}
}

country_event = { #망명위원회의 설립
	id = RED_event.14
	title = RED_event.14.t
	desc = RED_event.14.d
	picture = GFX_report_event_merchant_ship_01

	is_triggered_only = yes
		
	option = {
		name = RED_event.14.a
		unlock_decision_category_tooltip = RED_invite_trotskists_dec_cat
	}
}
country_event = { 
	id = RED_event.15
	title = RED_event.15.t
	desc = RED_event.15.d
	picture = GFX_report_event_hitler_handshake

	is_triggered_only = yes
	option = {
		name = RED_event.15.o 
	}
}
country_event = { #산별노조의 출범
	id = RED_event.16
	title = RED_event.16.t
	desc = RED_event.16.d
	picture = GFX_report_event_soviet_army_greeted

	is_triggered_only = yes
	option = {
		name = RED_event.16.o
		add_ideas = RED_worker_union_2
	}
} 
country_event = { #노동자를 위한 노동을
	id = RED_event.17
	title = RED_event.17.t
	desc = RED_event.17.d
	picture = GFX_report_event_long_march

	is_triggered_only = yes
	option = {
		name = RED_event.17.o
		hidden_effect = {
			remove_ideas = RED_infrastructure_union
			remove_ideas = RED_Civilian_factory_union_ideas
			remove_ideas = RED_military_union_ideas
			add_ideas = RED_the_worker_union
		}
		custom_effect_tooltip = RED_work_to_worker_tt
	}
}
country_event = { #자주관리
	id = RED_event.18
	title = RED_event.18.t
	desc = RED_event.18.d
	picture = GFX_report_event_tur_kurdish_guerillas

	is_triggered_only = yes
	option = {
		name = RED_event.18.o
	}
}
country_event = { #마리나를 거부한 용역부
	id = RED_event.19
	title = RED_event.19.t
	desc = RED_event.19.d
	picture = GFX_report_event_generic_funeral
	
	is_triggered_only = yes
	option = {
		name = RED_event.19.a
	}
}

country_event = { #여전히 남아있는 위협
	id = RED_event.20
	title = RED_event.20.t
	desc = RED_event.20.d
	picture = GFX_report_event_generic_rally2
	
	is_triggered_only = yes
	option = {
		name = RED_event.20.a
		add_dynamic_modifier = {
			modifier = RED_ThreatOfCovered5thLines_dynamic_modifier
		}
	}
}

country_event = { #국제 노동자들의 쉼터
	id = RED_event.21
	title = RED_event.21.t
	desc = RED_event.21.d
	picture = GFX_report_event_french_resistance_01
	is_triggered_only = yes
	option = {
		name = RED_event.21.a
	}
}

country_event = {
	id = REd_event.22
	title = REd_event.22.t
	desc = RED_event.22.d
	picture = GFX_report_event_generic_conference
	is_triggered_only = yes
	option = {
		name = RED_event.22.a
	}
}

country_event = {
	id = RED_event.23
	title = RED_event.23.t
	desc = RED_event.23.d
	picture = GFX_report_event_tur_the_montreux_convention
	is_triggered_only = yes
	option = {
		name = RED_event.23.a 
		custom_effect_tooltip = RED_worker_republic_tt
		hidden_effect = {
			remove_ideas = RED_Great_Council
			remove_ideas = RED_worekrs_research_ideas
			remove_ideas = RED_HYUSIK_ideas
			remove_ideas = RED_worekrunion3
			remove_ideas = RED_worekr_pro_idea
			add_ideas = RED_WORKERREPUBLIC
		}
	}
}